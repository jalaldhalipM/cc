<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Psychometric Assessment for Career Tracks in Tech">
    <title>Career Path Assessment</title>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* 
         * DESIGN SYSTEM & CSS
         * Theme: Modern, Clean, Glassmorphism touches
         */
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --accent: #06b6d4;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --success: #10b981;
            --border: #e2e8f0;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --font-family: 'Inter', system-ui, -apple-system, sans-serif;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0f172a;
                --surface: #1e293b;
                --text-main: #f1f5f9;
                --text-light: #94a3b8;
                --border: #334155;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* UTILITIES & ANIMATIONS */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-full {
            width: 100%;
        }

        /* CARDS */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        /* VIEWS */

        /* 1. Landing */
        .landing-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature-item {
            padding: 1rem;
            background: var(--background);
            border-radius: var(--radius);
            text-align: center;
        }

        /* 2. Question */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .progress-bar-track {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-number {
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--accent);
            font-weight: 700;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .options-grid {
            display: grid;
            gap: 1rem;
        }

        .option-card {
            display: flex;
            align-items: center;
            padding: 1.25rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .option-card:hover {
            border-color: var(--primary);
            background: var(--background);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .option-radio {
            margin-right: 1rem;
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* 3. Review */
        .review-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.75rem;
            margin: 2rem 0;
        }

        .review-item {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .review-item.answered {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .review-item:hover {
            transform: scale(1.05);
        }

        /* 4. Results */
        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .top-track-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
        }

        .top-track-label {
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.1em;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .top-track-name {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        .top-track-score {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 1rem 0;
        }

        .top-track-desc {
            font-size: 1.125rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .secondary-track-card {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        @media (min-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .chart-box {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            height: 350px;
            display: flex;
            flex-direction: column;
        }

        .chart-box h3 {
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1rem;
            color: var(--text-light);
        }

        .canvas-wrapper {
            position: relative;
            flex: 1;
            width: 100%;
            overflow: hidden;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3rem;
        }

        .ranking-table th {
            text-align: left;
            padding: 1rem;
            color: var(--text-light);
            font-size: 0.875rem;
            border-bottom: 1px solid var(--border);
        }

        .ranking-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .ranking-table tr:hover {
            background: var(--background);
        }

        .rank-num {
            font-weight: 700;
            color: var(--text-light);
            width: 40px;
        }

        .track-cell-name {
            font-weight: 600;
            color: var(--text-main);
        }

        .track-cell-desc {
            font-size: 0.875rem;
            color: var(--text-light);
            display: block;
            margin-top: 0.25rem;
        }

        .results-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding-bottom: 3rem;
        }

        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }

            .top-track-name {
                font-size: 1.5rem;
            }

            .top-track-score {
                font-size: 2.5rem;
            }

            .secondary-track-card {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Accessibly Hidden */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>

<body>

    <main class="container" id="app" aria-live="polite">
        <!-- Content injected by JS -->
    </main>

    <script>
        /**
         * PSYCHOMETRIC ASSESSMENT ENGINE
         * ------------------------------
         * To modify questions: Edit the `QUESTIONS` array.
         * To modify weights: Edit `Config.SCORING`.
         * 
         * Logic:
         * 1. Collects answers (mapping to T/C/M/A).
         * 2. Calculates raw trait scores.
         * 3. Applies formulas for 7 tracks.
         * 4. Normalizes and ranks.
         */

        // ==========================================
        // CONFIG & DATA
        // ==========================================
        const Config = {
            SCORING: {
                WEIGHT_HIGH: 0.60,
                WEIGHT_MED: 0.25,
                WEIGHT_LOW: 0.15
            },
            TRAITS: {
                T: "Technical",
                C: "Creative",
                M: "Management",
                A: "Analytical"
            },
            STORAGE_KEY: 'psycho_assessment_v1'
        };

        // Questions Data: Mappings (T/C/M/A) are hidden in this logic
        // Mappings: A=Technical, B=Creative, C=Management, D=Analytical (Example pattern, varied below)
        const QUESTIONS_LEVEL1 = [
            {
                id: 1,
                text: "A home appliance stops working. What do you do?",
                options: [
                    { text: "Try a quick fix to see if it works.", trait: "T" },
                    { text: "Think of another temporary solution.", trait: "C" },
                    { text: "Look for what might be causing it.", trait: "A" },
                    { text: "Organise what to do next with others.", trait: "M" }
                ]
            },
            {
                id: 2,
                text: "You see a new product advertisement. What catches your attention first?",
                options: [
                    { text: "Whether the message feels neat and organised.", trait: "M" },
                    { text: "How the product actually works.", trait: "T" },
                    { text: "The visuals and how fresh the idea looks.", trait: "C" },
                    { text: "Whether the message makes sense logically.", trait: "A" }
                ]
            },
            {
                id: 3,
                text: "You’re planning a family outing. What’s the first thing you do?",
                options: [
                    { text: "Find what everyone should do and when.", trait: "M" },
                    { text: "Compare different places carefully.", trait: "A" },
                    { text: "Look at how you can reach there easily.", trait: "T" },
                    { text: "Think of fun ideas to make it special.", trait: "C" }
                ]
            },
            {
                id: 4,
                text: "You receive a long message with lots of details. How do you handle it?",
                options: [
                    { text: "Pick out the most important points.", trait: "A" },
                    { text: "Rearrange the information so it flows better.", trait: "M" },
                    { text: "Try a simple action to understand it quickly.", trait: "T" },
                    { text: "Think of a clear example to relate it to.", trait: "C" }
                ]
            },
            {
                id: 5,
                text: "You bump into a confusing situation. What’s your instinct?",
                options: [
                    { text: "Try to solve it immediately with what you have.", trait: "T" },
                    { text: "Think of an unusual but possible solution.", trait: "C" },
                    { text: "Figure out where the confusion started.", trait: "A" },
                    { text: "Set a small plan to move ahead.", trait: "M" }
                ]
            },
            {
                id: 6,
                text: "You have to choose between two similar items. What helps you decide?",
                options: [
                    { text: "Which one fits your routine better.", trait: "M" },
                    { text: "Which option looks more appealing.", trait: "C" },
                    { text: "Which one works better for long term.", trait: "T" },
                    { text: "Which one makes more sense logically.", trait: "A" }
                ]
            },
            {
                id: 7,
                text: "Someone asks you to explain something. How do you start?",
                options: [
                    { text: "With a simple story or example.", trait: "C" },
                    { text: "With the first step of how to do it.", trait: "T" },
                    { text: "With a clear outline of the steps.", trait: "M" },
                    { text: "By breaking it into basic ideas.", trait: "A" }
                ]
            },
            {
                id: 8,
                text: "You’re assembling something new. What do you do first?",
                options: [
                    { text: "Try understanding how the parts connect.", trait: "A" },
                    { text: "Follow the steps in order.", trait: "M" },
                    { text: "Try assembling based on what feels right.", trait: "T" },
                    { text: "Try arranging it in a fresh, fun way.", trait: "C" }
                ]
            },
            {
                id: 9,
                text: "During a conversation, what do you naturally contribute?",
                options: [
                    { text: "Practical suggestions.", trait: "T" },
                    { text: "Fresh ideas others may not think of.", trait: "C" },
                    { text: "Organised ways to continue the topic.", trait: "M" },
                    { text: "Reasoned points based on logic.", trait: "A" }
                ]
            },
            {
                id: 10,
                text: "You’re choosing a gift for someone. How do you decide?",
                options: [
                    { text: "Something useful and reliable.", trait: "T" },
                    { text: "Something with a creative touch.", trait: "C" },
                    { text: "Something that suits their daily plan.", trait: "M" },
                    { text: "Something that fits their personality logically.", trait: "A" }
                ]
            },
            {
                id: 11,
                text: "You notice something is not working properly. What do you see first?",
                options: [
                    { text: "Some step in the process is off.", trait: "M" },
                    { text: "Something unusual in how it behaves. ", trait: "A" },
                    { text: "A small visible flaw or issue.", trait: "T" },
                    { text: "Something that doesn’t look right creatively.", trait: "C" }
                ]
            },
            {
                id: 12,
                text: "You’re helping a friend solve a small issue. What do you focus on?",
                options: [
                    { text: "Show them a simple fix.", trait: "T" },
                    { text: "Help them think through the cause.", trait: "A" },
                    { text: "Suggest a better-looking or fun way to do it.", trait: "C" },
                    { text: "Guide them through proper steps.", trait: "M" }
                ]
            },
            {
                id: 13,
                text: "You are stuck waiting somewhere. What do you do?",
                options: [
                    { text: "Try something new or fun to pass time.", trait: "C" },
                    { text: "Think of the pattern that caused the delay.", trait: "A" },
                    { text: "Adjust your schedule.", trait: "M" },
                    { text: "Check nearby options or tools to use.", trait: "T" }
                ]
            },
            {
                id: 14,
                text: "You see two people arguing. How do you respond?",
                options: [
                    { text: "Understand both sides calmly.", trait: "A" },
                    { text: "Try a light creative comment to ease tension.", trait: "C" },
                    { text: "Bring order by letting them talk in turn.", trait: "M" },
                    { text: "Suggest a simple fix they can try.", trait: "T" }
                ]
            },
            {
                id: 15,
                text: "You’re setting up your workspace. What do you care about most?",
                options: [
                    { text: "A unique or pleasant look.", trait: "C" },
                    { text: "Everything placed in proper order.", trait: "M" },
                    { text: "Tools and items that help you work better.", trait: "T" },
                    { text: "Logical arrangement of things.", trait: "A" }
                ]
            },
            {
                id: 16,
                text: "You need to learn something new. How do you begin?",
                options: [
                    { text: "Try it hands-on immediately.", trait: "T" },
                    { text: "Look for patterns or main ideas.", trait: "A" },
                    { text: "Use a creative approach to understand it.", trait: "C" },
                    { text: "Prepare a small plan.", trait: "M" }
                ]
            },
            {
                id: 17,
                text: "You’re asked to guide a junior. What do you focus on?",
                options: [
                    { text: "Showing them how to do it properly.", trait: "T" },
                    { text: "Helping them think through decisions.", trait: "A" },
                    { text: "Making it interesting for them to learn.", trait: "C" },
                    { text: "Giving them small steps to follow.", trait: "M" }
                ]
            },
            {
                id: 18,
                text: "Someone gives you mixed information. What do you do?",
                options: [
                    { text: "Re-arrange it in simple order.", trait: "M" },
                    { text: "Think creatively to find meaning.", trait: "C" },
                    { text: "Check possible causes.", trait: "A" },
                    { text: "Try small actions to test it.", trait: "T" }
                ]
            },
            {
                id: 19,
                text: "You see a trending idea online. What attracts you?",
                options: [
                    { text: "The unique twist behind it.", trait: "C" },
                    { text: "The reason it became popular.", trait: "A" },
                    { text: "How people are managing and timing posts.", trait: "M" },
                    { text: "How people are actually doing it.", trait: "T" }
                ]
            },
            {
                id: 20,
                text: "You buy something new. What do you explore first?",
                options: [
                    { text: "How good it looks or feels.", trait: "C" },
                    { text: "How it can be used efficiently.", trait: "T" },
                    { text: "Why it works the way it does.", trait: "A" },
                    { text: "Where it fits in your routine.", trait: "M" }
                ]
            }
        ];

        const TRACKS_LEVEL1 = [
            { id: 'ai', name: 'AI, ML & Data Science', formula: (s) => (0.60 * s.A + 0.25 * s.T + 0.15 * s.C), desc: "You excel at pattern recognition, logic, and technical implementation. This track combines analytical depth with engineering prowess.", course: "Advanced Machine Learning Specialization", secondary: "Data Engineering Professional Certificate" },
            { id: 'emerging_ai', name: 'Emerging AI', formula: (s) => (0.60 * s.C + 0.25 * s.A + 0.15 * s.T), desc: "You sit at the intersection of creativity and logic. This field explores generative AI, prompt engineering, and novel AI interfaces.", course: "Generative AI & LLM Development", secondary: "Creative Coding & AI Art" },
            { id: 'app_eng', name: 'Application Engineering', formula: (s) => (0.60 * s.T + 0.25 * s.A + 0.15 * s.M), desc: "The builder's path. You focus on robust code, architecture, and delivering functional systems.", course: "Full Stack Software Engineering Bootcamp", secondary: "Cloud Native Architecture" },
            { id: 'digital_infra', name: 'Digital Infrastructure & Security', formula: (s) => (0.60 * s.T + 0.25 * s.A + 0.15 * s.C), desc: "You protect and scale systems. Your analytical mind ensures stability, security, and efficiency.", course: "Cybersecurity & Cloud Operations", secondary: "DevOps & SRE Fundamentals" },
            { id: 'ui_ux', name: 'Interface & Experience Design', formula: (s) => (0.60 * s.C + 0.25 * s.M + 0.15 * s.A), desc: "You advocate for the user. Blending aesthetics with strategy, you define how products look and feel.", course: "Google UX Design Professional Certificate", secondary: "Human-Computer Interaction (HCI)" },
            { id: 'qa', name: 'Intelligent QA & Automation', formula: (s) => (0.60 * s.A + 0.25 * s.T + 0.15 * s.M), desc: "Quality is your north star. You combine coding skills with a detective's eye for defects.", course: "Test Automation University Certification", secondary: "Software Quality Assurance Expert" },
            { id: 'leadership', name: 'Project, Program & Product Leadership', formula: (s) => (0.60 * s.M + 0.25 * s.A + 0.15 * s.C), desc: "You see the big picture. Bridging gaps between teams, you ensure delivery and vision alignment.", course: "Product Management Certification", secondary: "Agile Leadership Professional" }
        ];

        const TRACKS_LEVEL2 = [
            {
                id: 'digital_infra',
                name: 'Digital Infrastructure & Security',
                strengths: ['Attention to Detail', 'Risk Awareness', 'Consistency & Rule-Based Thinking']
            },
            {
                id: 'emerging_ai',
                name: 'Emerging AI',
                strengths: ['Creative Reasoning', 'Abstract Thinking', 'Exploring Alternative Paths']
            },
            {
                id: 'ai_ml',
                name: 'AI, ML & Data Science',
                strengths: ['Pattern Recognition', 'Abstraction', 'Prediction Mindset']
            },
            {
                id: 'app_eng',
                name: 'Application Engineering',
                strengths: ['Debugging Mindset', 'System Structure Thinking', 'Ordered Thinking']
            },
            {
                id: 'ui_ux',
                name: 'Interface & Experience Design (UI/UX)',
                strengths: ['Empathy for Users', 'Design Reasoning', 'Interaction Intuition']
            },
            {
                id: 'qa',
                name: 'Intelligent QA & Automation',
                strengths: ['Spotting Issues Quickly', 'Testing Logic', 'Process Consistency']
            },
            {
                id: 'leadership',
                name: 'Project, Program & Product Leadership',
                strengths: ['Coordination', 'Planning', 'Prioritization & Clarity']
            }
        ];

        const QUESTIONS_LEVEL2 = [
            // Track 1: Digital Infrastructure & Security
            {
                id: 1, text: "You notice that one switch in your house feels warmer than the others when used. What feels most sensible to think?", trackId: 'digital_infra', strength: 'Attention to Detail',
                options: [
                    { text: "Some switches naturally feel warmer over time", score: 1 },
                    { text: "That switch might be handling more load than usual", score: 4 },
                    { text: "Different materials may react differently to use", score: 2 },
                    { text: "It could be connected to appliances used more often", score: 3 }
                ]
            },
            {
                id: 2, text: "You receive a bill that looks similar to last month’s, but the total amount is slightly higher. What do you do?", trackId: 'digital_infra', strength: 'Attention to Detail',
                options: [
                    { text: "Assume small changes happen from month to month", score: 1 },
                    { text: "Check if usage days or counts increased slightly", score: 3 },
                    { text: "Compare the item details with last month to spot changes", score: 4 },
                    { text: "Look at the final amount once more to confirm", score: 2 }
                ]
            },
            {
                id: 3, text: "You see water spilled close to an electrical extension box. What do you think is the best next step?", trackId: 'digital_infra', strength: 'Risk Awareness',
                options: [
                    { text: "Make sure no one steps there and check later", score: 1 },
                    { text: "Switch off nearby power before touching anything", score: 3 },
                    { text: "Move the extension box away and dry the area first", score: 4 },
                    { text: "Clean the water carefully while staying alert", score: 2 }
                ]
            },
            {
                id: 4, text: "A stranger messages you asking for a code that came to your phone, saying it’s urgent. What feels most reasonable?", trackId: 'digital_infra', strength: 'Risk Awareness',
                options: [
                    { text: "Take some time to understand what the message means", score: 2 },
                    { text: "Decline sharing and verify why the message came", score: 4 },
                    { text: "Check if the message looks similar to previous ones", score: 1 },
                    { text: "Ask for more details before taking any action", score: 3 }
                ]
            },
            {
                id: 5, text: "You usually lock your door every night, but one night you are very tired. What do you do?", trackId: 'digital_infra', strength: 'Consistency & Rule-Based Thinking',
                options: [
                    { text: "Lock it quickly without checking other entry points", score: 2 },
                    { text: "Lock the door as usual before going to bed", score: 4 },
                    { text: "Lock it later after settling down for the night", score: 1 },
                    { text: "Double-check the lock once and then sleep", score: 3 }
                ]
            },
            {
                id: 6, text: "You often keep important items in the same place so you can find them easily. Why do you prefer this?", trackId: 'digital_infra', strength: 'Consistency & Rule-Based Thinking',
                options: [
                    { text: "It feels more comfortable to follow a habit", score: 1 },
                    { text: "It saves time when I need things quickly", score: 3 },
                    { text: "It reduces mistakes and confusion over time", score: 4 },
                    { text: "It helps me remember where things are", score: 2 }
                ]
            },
            // Track 2: Emerging AI
            {
                id: 7, text: "You are explaining something to a friend, but they don’t seem to understand clearly. What do you try next?", trackId: 'emerging_ai', strength: 'Creative Reasoning',
                options: [
                    { text: "Repeat the same explanation more slowly and clearly", score: 1 },
                    { text: "Use a different example that connects to their daily life", score: 4 },
                    { text: "Break the explanation into smaller parts and go step by step", score: 2 },
                    { text: "Explain the idea using a simple story or situation", score: 3 }
                ]
            },
            {
                id: 8, text: "You are decorating a small room using only items already available at home. What approach makes sense to you?", trackId: 'emerging_ai', strength: 'Creative Reasoning',
                options: [
                    { text: "Keep the layout similar but adjust small details", score: 1 },
                    { text: "Rearrange items to change how the space feels", score: 3 },
                    { text: "Focus on placing items neatly and evenly", score: 2 },
                    { text: "Use the same items in a new way to create a fresh look", score: 4 }
                ]
            },
            {
                id: 9, text: "You feel mentally tired on days filled with many short interruptions. What do you think is the main reason?", trackId: 'emerging_ai', strength: 'Abstract Thinking',
                options: [
                    { text: "Small interruptions slowly add up over time", score: 2 },
                    { text: "Busy days naturally feel more tiring than calm ones", score: 1 },
                    { text: "Frequent breaks disturb the overall flow of the day", score: 4 },
                    { text: "Switching focus often makes it harder to stay engaged", score: 3 }
                ]
            },
            {
                id: 10, text: "You enjoy movies more when the main idea is clear, even if many details change. Why do you think that is?", trackId: 'emerging_ai', strength: 'Abstract Thinking',
                options: [
                    { text: "Too many details can distract attention", score: 2 },
                    { text: "A strong central idea matters more than small details", score: 4 },
                    { text: "Simpler stories feel more comfortable to watch", score: 1 },
                    { text: "Clear direction makes the story easier to follow", score: 3 }
                ]
            },
            {
                id: 11, text: "You usually take the same route to a place, but today it is crowded. What do you do?", trackId: 'emerging_ai', strength: 'Exploring Alternative Paths',
                options: [
                    { text: "Adjust your timing and continue on the same route", score: 2 },
                    { text: "Think of another route that could also get you there smoothly", score: 4 },
                    { text: "Move ahead slowly and see how the situation changes", score: 1 },
                    { text: "Choose a slightly longer route that avoids busy areas", score: 3 }
                ]
            },
            {
                id: 12, text: "You are learning something new, but the usual method doesn’t suit you well. What do you try?", trackId: 'emerging_ai', strength: 'Exploring Alternative Paths',
                options: [
                    { text: "Spend more time practising the same method carefully", score: 1 },
                    { text: "Modify the usual method to suit you a little better", score: 3 },
                    { text: "Try a different way that fits how you understand things best", score: 4 },
                    { text: "Combine parts of the usual method with another approach", score: 2 }
                ]
            },
            // Track 3: AI, ML & Data Science
            {
                id: 13, text: "You notice that every time you take the same bus after 6 PM, it feels more crowded than earlier in the day. What comes to your mind?", trackId: 'ai_ml', strength: 'Pattern Recognition',
                options: [
                    { text: "Crowding feels different depending on the day", score: 1 },
                    { text: "More people might be finishing work around that time", score: 4 },
                    { text: "That bus route is generally busy", score: 2 },
                    { text: "I usually notice crowds more in the evening", score: 3 }
                ]
            },
            {
                id: 14, text: "You realise that your phone battery drops faster on days you spend more time scrolling. What do you think?", trackId: 'ai_ml', strength: 'Pattern Recognition',
                options: [
                    { text: "Battery levels vary from day to day", score: 1 },
                    { text: "Using the phone continuously may affect the battery more", score: 4 },
                    { text: "The battery might already be old", score: 2 },
                    { text: "I probably use the phone longer on those days", score: 3 }
                ]
            },
            {
                id: 15, text: "You notice that you feel tired after meetings, no matter which topic is discussed. What feels most reasonable?", trackId: 'ai_ml', strength: 'Abstraction',
                options: [
                    { text: "My energy depends on many small things each day", score: 1 },
                    { text: "Long discussions generally drain my energy", score: 4 },
                    { text: "Some meetings are more engaging than others", score: 2 },
                    { text: "Sitting continuously might make me feel tired", score: 3 }
                ]
            },
            {
                id: 16, text: "When cooking different dishes, you realise you enjoy cooking more when the kitchen is organised. What do you think?", trackId: 'ai_ml', strength: 'Abstraction',
                options: [
                    { text: "I like cooking on some days more than others", score: 1 },
                    { text: "A tidy space helps me focus better overall", score: 4 },
                    { text: "Cooking feels smoother when things are in place", score: 2 },
                    { text: "I waste less time searching for items", score: 3 }
                ]
            },
            {
                id: 17, text: "You notice that whenever you sleep late, the next morning feels rushed. What do you expect if you sleep late again tonight?", trackId: 'ai_ml', strength: 'Prediction Mindset',
                options: [
                    { text: "Tomorrow could still feel different", score: 1 },
                    { text: "Tomorrow morning will likely feel hurried again", score: 4 },
                    { text: "It could affect my mood a little", score: 2 },
                    { text: "I might feel slightly less fresh in the morning", score: 3 }
                ]
            },
            {
                id: 18, text: "On days when it rains heavily, you usually reach home later than usual. What do you expect if it rains again today?", trackId: 'ai_ml', strength: 'Prediction Mindset',
                options: [
                    { text: "Travel time can change for many reasons", score: 1 },
                    { text: "I will probably take more time to reach home", score: 4 },
                    { text: "I might need to adjust my route", score: 2 },
                    { text: "Traffic may move slower than normal", score: 3 }
                ]
            },
            // Track 4: Application Engineering
            {
                id: 19, text: "While using a mixer, it suddenly stops and starts again after a short break. What would you check first?", trackId: 'app_eng', strength: 'Debugging Mindset',
                options: [
                    { text: "Whether the power supply at home fluctuates at times", score: 3 },
                    { text: "Whether it heats up after running for some time", score: 4 },
                    { text: "Whether this happens more during heavy use than light use", score: 1 },
                    { text: "Whether it was used continuously earlier in the day", score: 2 }
                ]
            },
            {
                id: 20, text: "Your phone feels slow on certain days but works fine on others. What seems most sensible to look at?", trackId: 'app_eng', strength: 'Debugging Mindset',
                options: [
                    { text: "Whether usage time was longer than usual that day", score: 1 },
                    { text: "Whether updates were running in the background", score: 2 },
                    { text: "What kind of apps were being used on the slow days", score: 4 },
                    { text: "Whether the phone had less free space at that time", score: 3 }
                ]
            },
            {
                id: 21, text: "You’re assembling a small shelf, and several parts look similar. What would you do before fixing anything?", trackId: 'app_eng', strength: 'System Structure Thinking',
                options: [
                    { text: "Start with the outer frame and handle inner parts later", score: 1 },
                    { text: "Group the parts by shape and size to understand them better", score: 4 },
                    { text: "Match parts roughly and adjust later if needed", score: 2 },
                    { text: "Arrange the parts in the order shown in the picture", score: 3 }
                ]
            },
            {
                id: 22, text: "Your phone storage shows “almost full.” What is a sensible way to handle this?", trackId: 'app_eng', strength: 'System Structure Thinking',
                options: [
                    { text: "Remove a few old photos and videos first", score: 2 },
                    { text: "Check which type of files are using most of the space", score: 4 },
                    { text: "Move some files to another location without checking details", score: 1 },
                    { text: "Clear large items you remember adding recently", score: 3 }
                ]
            },
            {
                id: 23, text: "You want to learn how to use a new household appliance properly. How would you begin?", trackId: 'app_eng', strength: 'Ordered Thinking',
                options: [
                    { text: "Use it as needed and adjust based on experience", score: 1 },
                    { text: "Follow the quick-start guide and explore more later", score: 3 },
                    { text: "Understand the basic steps before trying advanced features", score: 4 },
                    { text: "Try common functions first and learn the rest gradually", score: 2 }
                ]
            },
            {
                id: 24, text: "A ceiling fan starts making noise after some days of use. What would you do first?", trackId: 'app_eng', strength: 'Ordered Thinking',
                options: [
                    { text: "Observe it for a few days before taking action", score: 1 },
                    { text: "Try to identify exactly where the sound is coming from", score: 4 },
                    { text: "Adjust the speed settings to see if it changes", score: 2 },
                    { text: "Notice when the sound is louder or softer during use", score: 3 }
                ]
            },
            // Track 5: Interface & Experience Design (UI/UX)
            {
                id: 25, text: "You watch your parent using a new phone app and they keep tapping the wrong option. What do you think first?", trackId: 'ui_ux', strength: 'Empathy for Users',
                options: [
                    { text: "It takes time for anyone to get used to something new", score: 1 },
                    { text: "The options might be placed too close to each other", score: 4 },
                    { text: "They might be tapping a little too fast", score: 2 },
                    { text: "The text size could be a bit hard to read", score: 3 }
                ]
            },
            {
                id: 26, text: "At a railway station, you notice many people asking staff for directions. What feels most reasonable?", trackId: 'ui_ux', strength: 'Empathy for Users',
                options: [
                    { text: "People may not notice boards when they are in a hurry", score: 2 },
                    { text: "The signs may not be clear enough for first-time visitors", score: 4 },
                    { text: "New places always take time to understand", score: 1 },
                    { text: "The station might feel confusing when it’s crowded", score: 3 }
                ]
            },
            {
                id: 27, text: "You visit a website and feel comfortable using it even for the first time. Why do you think that is?", trackId: 'ui_ux', strength: 'Design Reasoning',
                options: [
                    { text: "The website matches what I usually expect", score: 1 },
                    { text: "Important things are easy to notice quickly", score: 4 },
                    { text: "The colours and spacing feel balanced", score: 2 },
                    { text: "The page does not feel too crowded", score: 3 }
                ]
            },
            {
                id: 28, text: "You see that people often return to the same screen again and again while using an app. What do you think might be happening?", trackId: 'ui_ux', strength: 'Design Reasoning',
                options: [
                    { text: "Users prefer to be careful before moving forward", score: 1 },
                    { text: "The next step may not be very clear", score: 4 },
                    { text: "The screen may have too much information", score: 2 },
                    { text: "People might be double-checking their choices", score: 3 }
                ]
            },
            {
                id: 29, text: "A button on a screen is often pressed by mistake. What feels most likely?", trackId: 'ui_ux', strength: 'Interaction Intuition',
                options: [
                    { text: "Accidental taps happen sometimes", score: 1 },
                    { text: "The button might look more important than it actually is", score: 4 },
                    { text: "People may be clicking without much focus", score: 2 },
                    { text: "It could be placed too close to other buttons", score: 3 }
                ]
            },
            {
                id: 30, text: "You notice users scrolling up and down many times before choosing an option. What does that suggest to you?", trackId: 'ui_ux', strength: 'Interaction Intuition',
                options: [
                    { text: "People often scroll before deciding", score: 1 },
                    { text: "They may not be sure what to do next", score: 4 },
                    { text: "The information might feel a bit heavy", score: 2 },
                    { text: "They might be comparing choices carefully", score: 3 }
                ]
            },
            // Track 6: Intelligent QA & Automation
            {
                id: 31, text: "You pour water into two identical glasses and notice one looks slightly more filled than the other. What do you do?", trackId: 'qa', strength: 'Spotting Issues Quickly',
                options: [
                    { text: "Think it may be because you poured one a bit faster", score: 2 },
                    { text: "Check both glasses closely to see the exact difference", score: 4 },
                    { text: "Assume the difference is too small to matter", score: 1 },
                    { text: "Adjust the water level a little to make them look similar", score: 3 }
                ]
            },
            {
                id: 32, text: "You receive a printed bill and feel the total is a bit higher than expected. What feels most sensible?", trackId: 'qa', strength: 'Spotting Issues Quickly',
                options: [
                    { text: "Consider that memory of prices may not be exact", score: 1 },
                    { text: "Go through each item once to confirm the amounts", score: 4 },
                    { text: "Think prices might have increased slightly", score: 2 },
                    { text: "Recheck the final total quickly", score: 3 }
                ]
            },
            {
                id: 33, text: "A pen writes well on some pages but skips on others. What would you do?", trackId: 'qa', strength: 'Testing Logic',
                options: [
                    { text: "Rotate the pen angle while writing", score: 2 },
                    { text: "Try writing on different pages to see when it skips", score: 4 },
                    { text: "Think the paper quality may vary", score: 1 },
                    { text: "Press the pen a little harder to test it", score: 3 }
                ]
            },
            {
                id: 34, text: "Your phone alarm works most days but fails once in a while. What feels reasonable to check?", trackId: 'qa', strength: 'Testing Logic',
                options: [
                    { text: "Assume occasional misses can happen", score: 1 },
                    { text: "Review the alarm settings to see if anything changes", score: 4 },
                    { text: "Notice whether the phone was on silent mode", score: 2 },
                    { text: "Test the alarm at different times once", score: 3 }
                ]
            },
            {
                id: 35, text: "When making tea, you always follow the same steps. Why do you do that?", trackId: 'qa', strength: 'Process Consistency',
                options: [
                    { text: "Habits naturally form over time", score: 1 },
                    { text: "It helps avoid mistakes and gives the same taste every time", score: 4 },
                    { text: "It feels easier than changing the method", score: 2 },
                    { text: "It saves time because the steps are familiar", score: 3 }
                ]
            },
            {
                id: 36, text: "Before leaving home, you check your bag in the same order daily. What’s the main reason?", trackId: 'qa', strength: 'Process Consistency',
                options: [
                    { text: "It feels comfortable to follow a routine", score: 1 },
                    { text: "It ensures nothing important is missed", score: 4 },
                    { text: "It helps remember things better", score: 2 },
                    { text: "It keeps the routine smooth and quick", score: 3 }
                ]
            },
            // Track 7: Project, Program & Product Leadership
            {
                id: 37, text: "Your family is getting ready to leave for an event, but everyone is doing different things. What do you do?", trackId: 'leadership', strength: 'Coordination',
                options: [
                    { text: "Focus on completing one useful task carefully", score: 1 },
                    { text: "Suggest who should handle which task so things move smoothly", score: 4 },
                    { text: "Check what others are doing and support where needed", score: 2 },
                    { text: "Take up the task that seems most urgent at that moment", score: 3 }
                ]
            },
            {
                id: 38, text: "Two people give you updates at the same time about the same plan. What feels most sensible?", trackId: 'leadership', strength: 'Coordination',
                options: [
                    { text: "Listen to both and form a combined understanding", score: 1 },
                    { text: "Ask them to share updates one by one so nothing overlaps", score: 4 },
                    { text: "Focus on the update that affects the next step most", score: 2 },
                    { text: "Listen carefully and connect the points they both mention", score: 3 }
                ]
            },
            {
                id: 39, text: "You have several small tasks to finish before the end of the day. How do you approach it?", trackId: 'leadership', strength: 'Planning',
                options: [
                    { text: "Begin with tasks that are already clear to you", score: 1 },
                    { text: "Decide a clear order and complete them step by step", score: 4 },
                    { text: "Group similar tasks and work through them together", score: 2 },
                    { text: "Start with the task that may take the most effort", score: 3 }
                ]
            },
            {
                id: 40, text: "You’re organising a short trip for a group. What do you do first?", trackId: 'leadership', strength: 'Planning',
                options: [
                    { text: "Follow a familiar approach used for similar trips before", score: 1 },
                    { text: "List the key things that must be decided before moving forward", score: 4 },
                    { text: "Decide the broad plan and refine details as choices appear", score: 2 },
                    { text: "Check possible travel and stay options to understand constraints", score: 3 }
                ]
            },
            {
                id: 41, text: "You have limited time, and two important things need attention. How do you decide?", trackId: 'leadership', strength: 'Prioritization & Clarity',
                options: [
                    { text: "Split time carefully so both make steady progress", score: 1 },
                    { text: "Choose the one that impacts more people if delayed", score: 4 },
                    { text: "Start with the one that reduces overall pressure", score: 2 },
                    { text: "Pick the one that has a fixed deadline first", score: 3 }
                ]
            },
            {
                id: 42, text: "You need to explain a plan to a group so everyone understands clearly. What do you do?", trackId: 'leadership', strength: 'Prioritization & Clarity',
                options: [
                    { text: "Explain the plan fully so no part is missed", score: 1 },
                    { text: "Start with the main goal, then explain the steps clearly", score: 4 },
                    { text: "Walk through the steps using a simple example", score: 2 },
                    { text: "Share the key points first, then explain details in order", score: 3 }
                ]
            }
        ];

        // ==========================================
        // APP LOGIC
        // ==========================================

        const App = (() => {
            // State
            let currentQuestion = 0;
            let currentLevel = 1; // 1 or 2
            let answers = []; // stores trait char 'T','C','M','A' (L1) or score number (L2)
            let appState = 'LANDING'; // LANDING, QUIZ, REVIEW, RESULTS

            // Current Data pointers
            let activeQuestions = QUESTIONS_LEVEL1;

            // DOM Elements
            const container = document.getElementById('app');

            // Utilities
            const saveState = () => localStorage.setItem(Config.STORAGE_KEY, JSON.stringify({ currentQuestion, answers, currentLevel, appState }));

            const loadState = () => {
                const data = localStorage.getItem(Config.STORAGE_KEY);
                if (data) {
                    const parsed = JSON.parse(data);
                    // Minimal validation
                    if (parsed.answers) {
                        currentLevel = parsed.currentLevel || 1;
                        activeQuestions = currentLevel === 2 ? QUESTIONS_LEVEL2 : QUESTIONS_LEVEL1;

                        // array length check
                        if (parsed.answers.length === activeQuestions.length) {
                            answers = parsed.answers;
                            currentQuestion = parsed.currentQuestion || 0;
                            // Helper to recover state if missing or weird
                            if (parsed.appState) {
                                appState = parsed.appState;
                            } else {
                                appState = answers.every(a => a) ? 'REVIEW' : 'QUIZ';
                            }
                            return true;
                        }
                    }
                }
                return false;
            };

            const clearState = () => {
                localStorage.removeItem(Config.STORAGE_KEY);
                currentQuestion = 0;
                currentLevel = 1;
                activeQuestions = QUESTIONS_LEVEL1;
                answers = [];
                appState = 'LANDING';
                updateView();
            };

            // Debug Function
            window.debugCalc = (t = 5, c = 5, m = 5, a = 5) => {
                console.group("Debug Calculation");
                console.log(`Inputs: T=${t}, C=${c}, M=${m}, A=${a}`);
                const scores = { T: t, C: c, M: m, A: a };
                TRACKS_LEVEL1.forEach(track => {
                    const raw = track.formula(scores);
                    const norm = raw * 5;
                    const pct = (norm / 60) * 100;
                    console.log(`${track.name}: Raw=${raw.toFixed(2)}, Norm=${norm.toFixed(2)}, Final=${pct.toFixed(1)}%`);
                });
                console.groupEnd();
            };

            // --------------------------------------
            // CORE SCORING
            // --------------------------------------
            const calculateResults = () => {
                if (currentLevel === 1) {
                    const counts = { T: 0, C: 0, M: 0, A: 0 };
                    answers.forEach(trait => { if (trait) counts[trait]++; });

                    let trackScores = TRACKS_LEVEL1.map(track => {
                        const raw = track.formula(counts);
                        const normalized = raw * 5;
                        const percentage = (normalized / 60) * 100;
                        return {
                            ...track,
                            raw,
                            normalized,
                            percentage: parseFloat(percentage.toFixed(1))
                        };
                    });

                    // Sort: Descending Percentage
                    trackScores.sort((a, b) => b.percentage - a.percentage);
                    return { level: 1, counts, trackScores };
                } else {
                    // Level 2 Scoring: Summation of option scores per track
                    let trackTotals = {};
                    TRACKS_LEVEL2.forEach(t => trackTotals[t.id] = 0);

                    answers.forEach((ans, idx) => {
                        if (ans) {
                            // ans is the score (1-4)
                            // We need to know which track this question belongs to.
                            // We can lookup question by index since answers index matches activeQuestions index
                            const q = activeQuestions[idx];
                            if (q && trackTotals[q.trackId] !== undefined) {
                                trackTotals[q.trackId] += parseInt(ans);
                            }
                        }
                    });

                    // Convert to array and sort
                    let trackScores = TRACKS_LEVEL2.map(track => {
                        const totalScore = trackTotals[track.id];
                        // Max score per track = 6 questions * 4 = 24
                        // Min score per track = 6 questions * 1 = 6

                        return {
                            ...track,
                            raw: totalScore,
                            percentage: Math.max(0, Math.round(((totalScore) / 24) * 100))
                        };
                    });

                    trackScores.sort((a, b) => b.raw - a.raw);
                    return { level: 2, trackScores };
                }
            };

            // --------------------------------------
            // RENDER FUNCTIONS
            // --------------------------------------

            const renderLanding = () => {
                const hasSaved = loadState() && answers.length > 0;

                return `
                    <div class="card fade-in landing-header" style="text-align: center;">
                        <h1>Discover Your Tech Persona</h1>
                        <p style="font-size: 1.125rem; color: var(--text-light); margin-bottom: 2rem;">
                            Choose your assessment level to find your ideal career track in technology.
                        </p>
                        
                        <div class="features">
                            <div class="feature-item">
                                <span style="font-size: 2rem; display:block; margin-bottom: 0.5rem;">🎯</span>
                                <strong>Level 1</strong>
                                <p style="font-size: 0.875rem;">20 Questions • ~5 Mins<br>Quick & Broad</p>
                            </div>
                            <div class="feature-item">
                                <span style="font-size: 2rem; display:block; margin-bottom: 0.5rem;">🚀</span>
                                <strong>Level 2</strong>
                                <p style="font-size: 0.875rem;">42 Questions • ~10 Mins<br>Deep & Detailed</p>
                            </div>
                        </div>

                        ${hasSaved ?
                        `<div style="margin-top: 1rem;">
                            <p style="margin-bottom: 0.5rem; color: var(--text-light);">You have an unfinished Level ${currentLevel} assessment.</p>
                            <button onclick="App.resumeTest()" class="btn btn-primary">Resume Level ${currentLevel}</button>
                            <button onclick="App.clearState()" class="btn btn-secondary" style="margin-left: 1rem;">Start Over</button>
                         </div>`
                        :
                        `<div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button onclick="App.startTest(1)" class="btn btn-primary" style="min-width: 160px;">Start Level 1</button>
                            <button onclick="App.startTest(2)" class="btn btn-primary" style="min-width: 160px; background-color: var(--accent);">Start Level 2</button>
                         </div>`
                    }
                    </div>
                `;
            };

            const renderQuestion = () => {
                const q = activeQuestions[currentQuestion];
                const progress = ((currentQuestion) / activeQuestions.length) * 100;

                return `
                    <div class="card fade-in">
                        <div class="progress-container">
                            <div class="progress-labels">
                                <span>Question ${currentQuestion + 1} of ${activeQuestions.length}</span>
                                <span>${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar-track">
                                <div class="progress-bar-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <div class="question-number">Question ${currentQuestion + 1}</div>
                        <h2 class="question-text">${q.text}</h2>

                        <div class="options-grid" role="radiogroup" aria-labelledby="q-text">
                            ${q.options.map((opt, idx) => {
                    // For Level 1: val is opt.trait. For Level 2: val is opt.score
                    const val = currentLevel === 1 ? opt.trait : opt.score;
                    const isSelected = answers[currentQuestion] == val;
                    return `
                                <label class="option-card ${isSelected ? 'selected' : ''}" tabindex="0" onkeydown="if(event.key==='Enter') this.click();">
                                    <input type="radio" name="q${q.id}" class="option-radio" 
                                        onclick="App.handleAnswer(${currentLevel === 1 ? `'${val}'` : val})"
                                        ${isSelected ? 'checked' : ''}>
                                    <span>${opt.text}</span>
                                </label>
                            `}).join('')}
                        </div>

                        <div class="nav-buttons">
                            <button onclick="App.prevQuestion()" class="btn btn-secondary" ${currentQuestion === 0 ? 'disabled' : ''}>Back</button>
                            ${answers[currentQuestion]
                        ? `<button onclick="App.nextQuestion()" class="btn btn-primary">Next</button>`
                        : `<button disabled class="btn btn-secondary" style="opacity: 0.5">Select an option</button>`
                    }
                        </div>
                    </div>
                `;
            };

            const renderReview = () => {
                const allAnswered = answers.every(a => a);
                return `
                    <div class="card fade-in">
                        <h2>Review Your Answers</h2>
                        <p style="color: var(--text-light); margin-top: 0.5rem;">Click any number to change your answer.</p>
                        
                        <div class="review-grid">
                            ${answers.map((ans, idx) => `
                                <button onclick="App.jumpTo(${idx})" class="review-item ${ans ? 'answered' : ''}">
                                    ${idx + 1}
                                </button>
                            `).join('')}
                        </div>

                        <div class="nav-buttons">
                            <button onclick="App.jumpTo(${activeQuestions.length - 1})" class="btn btn-secondary">Back</button>
                            <button onclick="App.showResults()" class="btn btn-primary" ${!allAnswered ? 'disabled title="Answer all questions first"' : ''}>
                                ${allAnswered ? 'Submit & View Results' : 'Complete All Questions'}
                            </button>
                        </div>
                    </div>
                `;
            };

            const renderResults = () => {
                const results = calculateResults();
                const primary = results.trackScores[0];

                // --- LEVEL 1 VIEW ---
                if (results.level === 1) {
                    const secondary = results.trackScores[1];
                    setTimeout(() => renderCharts(results), 0);

                    return `
                        <div class="fade-in">
                            <div class="results-header">
                                <h1>Assessment Results (Level 1)</h1>
                                <p style="color: var(--text-light);">Based on your unique profile</p>
                            </div>

                            <div class="top-track-card">
                                <div class="top-track-label">Primary Match</div>
                                <div class="top-track-name">${primary.name}</div>
                                <div class="top-track-score">${primary.percentage}%</div>
                                <div class="top-track-desc">
                                    ${primary.desc}
                                    <div style="margin-top: 1.5rem; font-weight: 600; background: rgba(255,255,255,0.2); padding: 0.5rem; border-radius: 8px; display: inline-block;">
                                        Recommended: ${primary.course}
                                    </div>
                                </div>
                            </div>

                            <div class="secondary-track-card">
                                <div>
                                    <div style="text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; color: var(--text-light); margin-bottom: 0.25rem;">Secondary Match</div>
                                    <h3 style="font-size: 1.25rem;">${secondary.name}</h3>
                                    <p style="font-size: 0.875rem; color: var(--text-light); margin-top: 0.25rem;">${secondary.course}</p>
                                </div>
                                <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">${secondary.percentage}%</div>
                            </div>

                            <div class="charts-container">
                                <div class="chart-box">
                                    <h3>Skill Distribution</h3>
                                    <div class="canvas-wrapper"><canvas id="skillsChart"></canvas></div>
                                </div>
                                <div class="chart-box">
                                    <h3>Track Alignment</h3>
                                    <div class="canvas-wrapper"><canvas id="tracksChart"></canvas></div>
                                </div>
                            </div>

                            <div class="card">
                                <h3 style="margin-bottom: 1.5rem;">Full Rankings</h3>
                                <table class="ranking-table">
                                    <tbody>
                                        ${results.trackScores.map((track, idx) => `
                                            <tr>
                                                <td class="rank-num">#${idx + 1}</td>
                                                <td>
                                                    <div class="track-cell-name">${track.name}</div>
                                                    <span class="track-cell-desc">${track.desc.substring(0, 100)}...</span>
                                                </td>
                                                <td style="text-align: right; font-weight: 700;">${track.percentage}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>

                            <div class="results-actions">
                                <button onclick="window.print()" class="btn btn-secondary">Download PDF / Print</button>
                                <button onclick="App.clearState()" class="btn btn-primary">Retake Assessment</button>
                            </div>
                        </div>
                    `;
                }
                // --- LEVEL 2 VIEW ---
                else {
                    return `
                        <div class="fade-in">
                            <div class="results-header">
                                <h1>Assessment Results (Level 2)</h1>
                                <p style="color: var(--text-light);">Detailed Analysis by Track & Strength</p>
                            </div>

                            <div class="top-track-card">
                                <div class="top-track-label">Top Recommended Track</div>
                                <div class="top-track-name">${primary.name}</div>
                                <div class="top-track-score">Rank #1</div>
                                <div class="top-track-desc">
                                    You showed the highest strength in this area.
                                </div>
                            </div>

                            <div class="card">
                                <h3 style="margin-bottom: 1.5rem;">Track Rankings & Strengths</h3>
                                <div style="display: grid; gap: 1.5rem;">
                                    ${results.trackScores.map((track, idx) => `
                                        <div style="border: 1px solid var(--border); border-radius: 8px; padding: 1rem; background: ${idx === 0 ? 'var(--background)' : 'transparent'};">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                                <h4 style="font-size: 1.125rem; font-weight: 700; color: var(--primary);">#${idx + 1} ${track.name}</h4>
                                                <span style="font-weight: 600; color: var(--text-light);">${track.raw} pts</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: var(--text-main);">
                                                <strong>Strengths Evaluated:</strong>
                                                <ul style="margin-left: 1.5rem; margin-top: 0.25rem; color: var(--text-light);">
                                                    ${track.strengths.map(s => `<li>${s}</li>`).join('')}
                                                </ul>
                                            </div>
                                        `).join('')}
                                </div>
                            </div>

                            <div class="results-actions" style="margin-top: 2rem;">
                                <button onclick="window.print()" class="btn btn-secondary">Download PDF / Print</button>
                                <button onclick="App.clearState()" class="btn btn-primary">Retake Assessment</button>
                            </div>
                        </div>
                    `;
                }
            };

            const renderCharts = (results) => {
                // Skills Chart (Donut)
                new Chart(document.getElementById('skillsChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Technical', 'Creative', 'Management', 'Analytical'],
                        datasets: [{
                            data: [results.counts.T, results.counts.C, results.counts.M, results.counts.A],
                            backgroundColor: ['#2563eb', '#06b6d4', '#8b5cf6', '#10b981'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom' } }
                    }
                });

                // Tracks Chart (Horizontal Bar)
                new Chart(document.getElementById('tracksChart'), {
                    type: 'bar',
                    indexAxis: 'y',
                    data: {
                        labels: results.trackScores.map(t => t.name.split(' ')[0]), // Shorten names for axis
                        datasets: [{
                            label: 'Match %',
                            data: results.trackScores.map(t => t.percentage),
                            backgroundColor: '#2563eb',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { max: 100, beginAtZero: true } }
                    }
                });
            };

            // Main Render Switch
            const updateView = () => {
                container.innerHTML = '';
                window.scrollTo(0, 0);

                switch (appState) {
                    case 'LANDING':
                        container.innerHTML = renderLanding();
                        break;
                    case 'QUIZ':
                        container.innerHTML = renderQuestion();
                        break;
                    case 'REVIEW':
                        container.innerHTML = renderReview();
                        break;
                    case 'RESULTS':
                        container.innerHTML = renderResults();
                        break;
                    default:
                        container.innerHTML = renderLanding();
                }
            };

            // --------------------------------------
            // PUBLIC HANDLERS
            // --------------------------------------

            return {
                init: () => {
                    // Try to load state. 
                    // If we find valid state, we might set appState to inferred value
                    // BUT for init, strictly, we want to show LANDING so user can choose.
                    // Unless we validly saved 'RESULTS' or 'QUIZ' and want to auto-resume?
                    // The prompt didn't specify auto-resume.
                    // The landing page has a "Resume" button.
                    // So we should force LANDING on init.

                    loadState();
                    appState = 'LANDING';
                    updateView();
                },
                startTest: (level) => {
                    currentLevel = level;
                    activeQuestions = level === 1 ? QUESTIONS_LEVEL1 : QUESTIONS_LEVEL2;
                    currentQuestion = 0;
                    answers = new Array(activeQuestions.length).fill(null);
                    appState = 'QUIZ';
                    saveState();
                    updateView();
                },
                resumeTest: () => {
                    // loadState() called in init.
                    // recover appState
                    appState = answers.every(a => a) ? 'REVIEW' : 'QUIZ';
                    updateView();
                },
                handleAnswer: (trait) => {
                    answers[currentQuestion] = trait;
                    saveState();
                    // Slight delay to show selection
                    setTimeout(() => {
                        if (currentQuestion < activeQuestions.length - 1) {
                            currentQuestion++;
                            updateView(); // remains in QUIZ
                        } else {
                            appState = 'REVIEW';
                            saveState();
                            updateView();
                        }
                    }, 250);
                },
                prevQuestion: () => {
                    if (currentQuestion > 0) {
                        currentQuestion--;
                        updateView();
                    }
                },
                nextQuestion: () => { // Manual next button
                    if (currentQuestion < activeQuestions.length - 1) {
                        currentQuestion++;
                        updateView();
                    } else {
                        appState = 'REVIEW';
                        saveState();
                        updateView();
                    }
                },
                jumpTo: (idx) => {
                    currentQuestion = idx;
                    appState = 'QUIZ';
                    updateView();
                },
                showResults: () => {
                    if (!answers.every(a => a)) {
                        alert('Please answer all questions first.');
                        return;
                    }
                    appState = 'RESULTS';
                    saveState();
                    updateView();
                },
                clearState: clearState
            };

        })();

        // Start App
        document.addEventListener('DOMContentLoaded', App.init);

    </script>
</body>

</html>
